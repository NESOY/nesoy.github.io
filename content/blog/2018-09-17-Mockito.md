---
title: Mockitoë€?
date: 2018-09-17
aliases: 
  - ../articles/2018-09/Mockito
---

![[Assets/logo/mockito.png]]

## Mockitoë€?
- ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ Java mocking frameworkì…ë‹ˆë‹¤.

## How to install? ğŸ§
- [Mockito Maven](https://mvnrepository.com/artifact/org.mockito/mockito-all/1.10.19)

```xml
<!-- https://mvnrepository.com/artifact/org.mockito/mockito-all -->
<dependency>
    <groupId>org.mockito</groupId>
    <artifactId>mockito-all</artifactId>
    <version>1.10.19</version>
    <scope>test</scope>
</dependency>
```

- [Junit Maven](https://mvnrepository.com/artifact/junit/junit/4.12)

```xml
<!-- https://mvnrepository.com/artifact/junit/junit -->
<dependency>
    <groupId>junit</groupId>
    <artifactId>junit</artifactId>
    <version>4.12</version>
    <scope>test</scope>
</dependency>
```

## How to use? ğŸ®

### mock(), @Mock, @InjectMocks
- @Mock
    - mock ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ ë°˜í™˜í•©ë‹ˆë‹¤.
- @InjectMocks
    - @Mockì´ë‚˜ @Spy ê°ì²´ë¥¼ ìì‹ ì˜ ë©¤ë²„ í´ë˜ìŠ¤ì™€ ì¼ì¹˜í•˜ë©´ ì£¼ì…ì‹œí‚µë‹ˆë‹¤.

```java
// staticìœ¼ë¡œ importë¥¼ í•˜ê²Œ ë˜ë©´ ì¡°ê¸ˆ ë” ê¹¨ë—í•˜ê²Œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
import static org.mockito.Mockito.*;

// mock ì²˜ë¦¬ë¥¼ í•©ë‹ˆë‹¤.
// Annotation, mock() Method ê°™ì€ í‘œí˜„ì…ë‹ˆë‹¤.
@Mock
List annotationMockedList
List mockedList = mock(List.class);


//using mock object
mockedList.add("one");
mockedList.clear();

//ê²€ì¦ - ì„±ê³µ
verify(mockedList).add("one"); // add("one")ê°€ í˜¸ì¶œë˜ì—ˆëŠ”ì§€ ê²€ì¦í•©ë‹ˆë‹¤.
verify(mockedList).clear(); // clear()ê°€ í˜¸ì¶œë˜ì—ˆëŠ”ì§€ ê²€ì¦í•©ë‹ˆë‹¤.
//ê²€ì¦ - ì‹¤íŒ¨
verify(mockedList).add("two"); // add("two")ì´ í˜¸ì¶œì´ ë˜ì§€ ì•Šì•˜ê¸°ì— ì‹¤íŒ¨í•©ë‹ˆë‹¤.
```

### stubbing

```java
// êµ¬ì²´ì ì¸ í´ë˜ìŠ¤ë¥¼ mock ì²˜ë¦¬í•©ë‹ˆë‹¤.
LinkedList mockedList = mock(LinkedList.class);

//stubbing
when(mockedList.get(0)).thenReturn("first"); // get(0)ì´ í˜¸ì¶œë˜ë©´ "first"ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
when(mockedList.get(1)).thenThrow(new RuntimeException()); // get(1)ì´ í˜¸ì¶œë˜ë©´ RuntimeException ì—ëŸ¬ë¥¼ ë°œìƒí•©ë‹ˆë‹¤.

System.out.println(mockedList.get(0)); // "first"
System.out.println(mockedList.get(1)); // RuntimeException()
System.out.println(mockedList.get(999)); // 999ì— ëŒ€í•œ stub ì²˜ë¦¬ë¥¼ í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— nullê°’ì´ returnë©ë‹ˆë‹¤.
```


### ë§¤ê°œë³€ìˆ˜ ê²€ì¦

```java
// ëª¨ë“  Integer íƒ€ì… ë§¤ê°œë³€ìˆ˜ë¥¼ ë°›ì„ ê²½ìš° "element"ë¥¼ ëŒë ¤ì¤ë‹ˆë‹¤.
when(mockedList.get(anyInt())).thenReturn("element");

//ì»¤ìŠ¤í…€ Matcherë¥¼ ì‚¬ìš©í•˜ì—¬ stubingí•©ë‹ˆë‹¤.
when(mockedList.contains(argThat(isValid()))).thenReturn("element");

// "element"
System.out.println(mockedList.get(999));

// ê²€ì¦ - Integer íƒ€ì… ë§¤ê°œë³€ìˆ˜ë¥¼ ë°›ìœ¼ë©° í˜¸ì¶œë˜ì—ˆëŠ”ì§€ ê²€ì¦í•©ë‹ˆë‹¤.
verify(mockedList).get(anyInt());
// ê²€ì¦ - argument matchers
verify(mockedList).add(argThat(someString -> someString.length() > 5));

// ê°’ì„ ê²€ì¦í• ë•Œì—ëŠ” eq()ë¡œ ê°ì‹¸ì•¼ í˜¸ì¶œí•´ì•¼ í•©ë‹ˆë‹¤.
verify(mock).someMethod(anyInt(), anyString(), eq("third argument"));
// ê·¸ë ‡ì§€ ì•Šì„ ê²½ìš° ì‹¤íŒ¨í•˜ê²Œ ë©ë‹ˆë‹¤.
verify(mock).someMethod(anyInt(), anyString(), "third argument");
```


### í˜¸ì¶œíšŸìˆ˜, í˜¸ì¶œì‹œê°„ ê²€ì¦
- times(1)ì€ ê¸°ë³¸ê°’ì…ë‹ˆë‹¤.

```java
//using mock
mockedList.add("once");

mockedList.add("twice");
mockedList.add("twice");

mockedList.add("three times");
mockedList.add("three times");
mockedList.add("three times");

// ê²€ì¦ ë°©ë²•ì—ëŠ” ì•„ë˜ì™€ ê°™ì´ 2ê°€ì§€ ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.
verify(mockedList).add("once");
verify(mockedList, times(1)).add("once");


// ì•„ë˜ì™€ ê°™ì´ 2, 3ë²ˆë„ ê²€ì¦ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤ :D
verify(mockedList, times(2)).add("twice");
verify(mockedList, times(3)).add("three times");

// í•œë²ˆë„ í˜¸ì¶œë˜ì§€ ì•ŠëŠ” ê²½ìš° never()ê°™ì´ í‘œí˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ ::= times(0)
verify(mockedList, never()).add("never happened");

// ì ì–´ë„ í•œë²ˆ, ì ì–´ë„ xë²ˆ, ìµœëŒ€ xë²ˆ
verify(mockedList, atLeastOnce()).add("three times");
verify(mockedList, atLeast(2)).add("three times");
verify(mockedList, atMost(5)).add("three times");

// ì‹œê°„ì— ëŒ€í•œ ê²€ì¦
verify(mockedList, timeout(100)).add("three times");

// ì‹œê°„ & íšŸìˆ˜ ê²€ì¦
verify(mock, timeout(100).times(2)).someMethod();
verify(mock, timeout(100).atLeast(2)).someMethod();
```

### Stubbing void Method

```java
// mockedListì˜ clearë¥¼ í˜¸ì¶œí•˜ì˜€ì„ë•Œ RunTimeExceptionì„ ë°˜í™˜í•˜ê²Œ ë©ë‹ˆë‹¤.
doThrow(new RuntimeException()).when(mockedList).clear();

// RuntimeException
mockedList.clear();
```

### ìˆœì„œì— ëŒ€í•œ ê²€ì¦

```java
List singleMock = mock(List.class);

singleMock.add("was added first");
singleMock.add("was added second");

// ì¤‘ìœ„ ìˆœíšŒ Case
InOrder inOrder = inOrder(singleMock);

// "was added first"ë¶€í„° ê²€ì¦í›„ "was added second"ë¥¼ ê²€ì¦í•˜ì—¬ ìˆœì„œì— ëŒ€í•œ ê²€ì¦ì„ ì§„í–‰í•©ë‹ˆë‹¤.
inOrder.verify(singleMock).add("was added first");
inOrder.verify(singleMock).add("was added second");
```

### ì•„ë¬´ì¼ì´ ì¼ì–´ë‚˜ì§€ ì•ŠëŠ” mockì— ëŒ€í•œ ê²€ì¦

```java
// mockOneë§Œ addë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
mockOne.add("one");

// ì¼ë°˜ì ì¸ ê²€ì¦ì…ë‹ˆë‹¤.
verify(mockOne).add("one");
verify(mockOne, never()).add("two");

// ë‚˜ë¨¸ì§€ mockì€ ì•„ë¬´ ì¼ì´ ë°œìƒí•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ê·¸ ë¶€ë¶„ì— ëŒ€í•œ ê²€ì¦ì…ë‹ˆë‹¤.
verifyZeroInteractions(mockTwo, mockThree);
```

### ì—°ì†ì ì¸ Stubbing

```java
when(mock.someMethod("some arg"))
.thenThrow(new RuntimeException()) // ì²«ë²ˆì§¸ Return
.thenReturn("foo");                // ë‘ë²ˆì§¸ Return

//ì²«ë²ˆì§¸ call: throws runtime exception:
mock.someMethod("some arg");

//ë‘ë²ˆì§¸ call: "foo"
System.out.println(mock.someMethod("some arg"));

//ê°€ì¥ ë§ˆì§€ë§‰ Stubbingí•œ ê°’ì„ Return í•©ë‹ˆë‹¤.
System.out.println(mock.someMethod("some arg"));

// í˜¸ì¶œí•œ ìˆœì„œëŒ€ë¡œ ê²°ê³¼ê°’ì„ Return í•©ë‹ˆë‹¤.
when(mock.someMethod("some arg"))
.thenReturn("one", "two", "three");
```

### Spying, @Spy
- Spyë¥¼ í†µí•´ ì‹¤ì œ ê°ì²´ë¥¼ ìƒì„±í•˜ê³  í•„ìš”í•œ ë¶€ë¶„ì—ë§Œ mockì²˜ë¦¬í•˜ì—¬ ê²€ì¦ì„ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```java
List list = new LinkedList();
List spy = spy(list);

// Methodì— ëŒ€í•œ stubbing
when(spy.size()).thenReturn(100);

// ì‹¤ì œ ê°ì²´ì˜ Methodë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
spy.add("one");
spy.add("two");

// "one"
System.out.println(spy.get(0));

// Stubbingëœ Methodì˜ ê²°ê³¼ : 100
System.out.println(spy.size());


// Spyì˜ ì£¼ì˜í•  ì .
List list = new LinkedList();
List spy = spy(list);

// ì‹¤ì œ ê°ì²´ì— ì•„ë¬´ê²ƒë„ ì—†ê¸°ë•Œë¬¸ì— whenì„ í˜¸ì¶œí•˜ê²Œ ë˜ë©´ IndexOutofBoundsExceptionì´ ë°œìƒí•©ë‹ˆë‹¤.
when(spy.get(0)).thenReturn("foo");

// ê·¸ë ‡ê¸° ë•Œë¬¸ì— doReturnìœ¼ë¡œ stubbingì„ ì§„í–‰í•©ë‹ˆë‹¤.
doReturn("foo").when(spy).get(0);
```


## Reference
- <http://static.javadoc.io/org.mockito/mockito-core/2.22.0/org/mockito/Mockito.html>
- <https://jdm.kr/blog/222>
